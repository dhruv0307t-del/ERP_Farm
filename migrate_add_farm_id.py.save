# migrate_add_farm_id.py
import sqlite3
from pathlib import Path

DB = Path("erp.db")
if not DB.exists():
    print("erp.db not found — nothing to migrate.")
    raise SystemExit(1)

conn = sqlite3.connect(str(DB))
cur = conn.cursor()

# check if 'user' table exists
cur.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='user'")
if not cur.fetchone():
    print("No 'user' table found — nothing to migrate.")
    conn.close()
    raise SystemExit(1)

# check columns
cur.execute("PRAGMA table_info('user')")
cols = [r[1] for r in cur.fetchall()]
if "farm_id" in cols:
    print("Column farm_id already present — migration not needed.")
else:
    print("Adding column farm_id to user table...")
    cur.execute("ALTER TABLE user ADD COLUMN farm_id INTEGER")
    conn.commit()
    print("Column farm_id added successfully.")

conn.close()

